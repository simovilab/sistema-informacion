# A1

::: info Recolección de datos y construcción de suministros

La acción básica de este subsistema es recopilar los datos del servicio de transporte público y recolectar y transformar los datos de telemetría y rastreo de los vehículos para publicación en suministros (_feeds_) de datos GTFS _Schedule_ y GTFS _Realtime_.

:::

**_Entradas_**

| Nombre               | Descripción                                                   |
| -------------------- | ------------------------------------------------------------- |
| GTFS _Schedule_      | Formato común para información estática de transporte público |
| Datos en tiempo real | Telemetría y rastreo de vehículos                             |
| Alertas del servicio | Reporte de afectaciones al servicio                           |

**_Salidas_**

| Nombre          | Descripción                                                   |
| --------------- | ------------------------------------------------------------- |
| GTFS _Schedule_ | Formato común para información estática de transporte público |
| GTFS _Realtime_ | Especificación para proporcionar información GTFS actualizada |

**_Interfaces_**

| Nombre                | Descripción                                                      |
| --------------------- | ---------------------------------------------------------------- |
| API REST              | Interfaz RESTful para operaciones CRUD y consultas de datos      |
| API GraphQL           | Interfaz de consultas flexibles con suscripciones en tiempo real |
| HTTPS (Protobuf, ZIP) | Publicación de suministos GTFS _Realtime_ y _Schedule_           |
| MQTT                  | Protocolo de mensajería para telemetría vehicular en tiempo real |

**_Servicios_**

| Nombre                  | Descripción                       |
| ----------------------- | --------------------------------- |
| Panel de administración | Control de parámetros del sistema |

## Componentes

La siguiente es la tabla resumen de los componentes de la arquitectura.

| Código | Componente                 |
| :----: | -------------------------- |
|  A1a   | Servidor en tiempo real    |
|  A1b   | Base de datos              |
|  A1c   | Base de datos en memoria   |
|  A1d   | Intermediador pub/sub      |
|  A1e   | Aplicación móvil operativa |

A continuación hay una descripción general de cada componente.

## Servidor en tiempo real

Plataforma central de procesamiento que recolecta, valida y transforma datos de rastreo y telemetría del transporte público en tiempo real. Genera y mantiene suministros (_feeds_) actualizados de GTFS _Schedule_ y GTFS _Realtime_ para distribución a aplicaciones cliente y sistemas externos.

|       Elemento | Valor                                             |
| -------------: | ------------------------------------------------- |
|         Código | A1a                                               |
|  Clasificación | Aplicación                                        |
|       Catálogo | <CatalogItem catalog="applications" item="001" /> |
| Implementación | [Databús RT](/desarrollo/databus/#databus-rt)     |

### Características generales

- **Procesamiento en tiempo real:** Latencia menor a 1 segundo para datos críticos
- **Tolerancia a fallos:** Redundancia automática y recuperación ante interrupciones
- **Monitoreo y alertas:** Sistema de métricas y notificaciones

### Relaciones con el sistema

| Relación          | Ítem de catálogo                                              |
| ----------------- | ------------------------------------------------------------- |
| implementa        | <CatalogItem catalog="principles" item="D02" show="name" />   |
| se realiza con    | <CatalogItem catalog="applications" item="001" show="name" /> |
| usado por         | <CatalogItem catalog="principles" item="A02" show="name" />   |
| es servido por    | <CatalogItem catalog="requirements" item="001" show="name" /> |
| es del interés de | <CatalogItem catalog="stakeholders" item="001" show="name" /> |
| es del interés de | <CatalogItem catalog="stakeholders" item="002" show="name" /> |
| usa               | <CatalogItem catalog="entities" item="002" show="name" />     |

### Subcomponentes

| Código | Nombre                  | Descripción                                           |
| ------ | ----------------------- | ----------------------------------------------------- |
| A1a-1  | Procesador GTFS         | Gestión integral de GTFS _Schedule_ y GTFS _Realtime_ |
| A1a-2  | API REST                | Interfaz RESTful para operaciones CRUD                |
| A1a-3  | API GraphQL             | Interfaz de consultas flexibles                       |
| A1a-4  | Cola de tareas          | Gestión asíncrona de trabajos en segundo plano        |
| A1a-5  | Procesamiento de flujos | Análisis continuo de datos en tiempo real             |

#### Procesador GTFS

Realiza la gestión integral para datos y procesos relacionados con GTFS _Schedule_ y GTFS _Realtime_. Proporciona herramientas para la administración del ciclo de vida de datos de transporte público, desde la importación hasta la distribución.

|       Elemento | Valor                                             |
| -------------: | ------------------------------------------------- |
|         Código | A1a-1                                             |
|  Clasificación | Aplicación                                        |
|       Catálogo | <CatalogItem catalog="applications" item="001" /> |
| Implementación | [Databús GTFS](/desarrollo/databus/#databus-gtfs) |

##### Características específicas

- **Modelos de datos conformes:** Implementación completa de especificaciones GTFS con validación estricta
- **Importación robusta:** Procesamiento con validación, transformación y reconciliación de datos
- **Exportación optimizada:** Generación eficiente de _feeds_ con compresión y versionado
- **Sincronización tiempo real:** Puente entre GTFS _Schedule_ estático y actualizaciones dinámicas
- **Transformación de protocolos:** Conversión entre formatos de telemetría y estándares GTFS

#### Interfaz API REST

Interfaz de programación de aplicaciones (API) RESTful que proporciona acceso estructurado y escalable a datos operativos del sistema de transporte público. Diseñada para integración con sistemas externos, aplicaciones móviles y herramientas de administración con patrones estándar de la industria.

|       Elemento | Valor                                             |
| -------------: | ------------------------------------------------- |
|         Código | A1a-2                                             |
|  Clasificación | Interfaz                                          |
|       Catálogo | <CatalogItem catalog="applications" item="001" /> |
| Implementación | [Databús API](/desarrollo/databus/#databus-api)   |

##### Características específicas

- **Especificación OpenAPI 3.0:** Documentación automática e interactiva de terminales (_endpoints_)
- **Autenticación OAuth 2.0 / JWT:** _Tokens_ seguros con alcance de acceso (_scope_) granular y renovación automática
- **Límite de consultas dinámico:** Límites adaptativos por cliente
- **Versionado semántico:** Compatibilidad hacia atrás con evolución controlada de API
- **Paginación inteligente:** División en páginas para grandes conjuntos de datos
- **Filtrado y ordenamiento:** Parámetros flexibles para consultas personalizadas

#### Interfaz API GraphQL

Interfaz de programación de aplicaciones (API) GraphQL que permite consultas flexibles y eficientes mediante un esquema unificado. Optimizada para clientes que requieren datos específicos con mínima transferencia de red y máxima expresividad en las consultas.

|       Elemento | Valor                                                   |
| -------------: | ------------------------------------------------------- |
|         Código | A1a-3                                                   |
|  Clasificación | Interfaz                                                |
|       Catálogo | <CatalogItem catalog="applications" item="001" />       |
| Implementación | [Databús GraphQL](/desarrollo/databus/#databus-graphql) |

##### Características específicas

- **Esquema tipado fuerte:** Definición explícita de tipos con validación automática
- **Suscripciones en tiempo real:** WebSocket connections para actualizaciones instantáneas

## Base de datos

Sistema de almacenamiento principal para datos operativos e históricos del transporte público, optimizado para consultas geoespaciales, análisis temporal y gestión de grandes volúmenes de información estructurada y semi-estructurada.

|       Elemento | Valor                                             |
| -------------: | ------------------------------------------------- |
|         Código | A1b                                               |
|  Clasificación | Componente de datos                               |
|       Catálogo | <CatalogItem catalog="applications" item="001" /> |
| Implementación | [Databús DB](/desarrollo/databus/#databus-db)     |

### Características generales

- **Motor relacional:** Transacciones ACID, integridad referencial
- **Respaldo automatizado:** Respaldos incrementales con retención configurable

### Subcomponentes

| Código | Nombre                | Descripción                                           |
| ------ | --------------------- | ----------------------------------------------------- |
| A1b-1  | Extensión geoespacial | Consultas espaciales, índices geométricos, etc.       |
| A1b-2  | Series temporales     | Optimización para almacenamiento de series temporales |
| A1b-3  | Documentos            | Soporte JSON/JSONB/BSON para almacenamiento flexible  |

## Base de datos en memoria

Caché de alta velocidad para datos temporales de rastreo y telemetría que requieren acceso rápido durante el procesamiento en tiempo real. Actúa como _buffer_ entre la ingesta de datos y el almacenamiento persistente.

|       Elemento | Valor                                             |
| -------------: | ------------------------------------------------- |
|         Código | A1c                                               |
|  Clasificación | Componente de datos                               |
|       Catálogo | <CatalogItem catalog="applications" item="001" /> |
| Implementación | [Databús IMDB](/desarrollo/databus/#databus-imdb) |

### Subcomponentes

| Código | Nombre              | Descripción                                              |
| ------ | ------------------- | -------------------------------------------------------- |
| A1c-1  | Tabla de dispersión | Instantáneas de estado con acceso rápido por llave-valor |
| A1c-2  | Registro de anexión | Flujos de eventos con procesamiento secuencial ordenado  |

### Características generales

- **Latencia sub-milisegundo:** Acceso inmediato a datos frecuentemente consultados
- **Estructura de datos especializada:** Tablas con _hash_, conjuntos ordenados para consultas optimizadas
- **Expiración automática (TTL):** Limpieza automática de datos obsoletos
- **Persistencia opcional:** _Snapshots_ periódicos para recuperación ante fallos
- **Compresión en memoria:** Optimización del uso de RAM para mayor capacidad
- **Pub/Sub integrado:** Notificaciones en tiempo real de cambios de estado

## Intermediador pub/sub

Intermediador (_broker_) de mensajes de publicación/suscripción MQTT de alto desempeño especializado en telemetría vehicular y comunicación en tiempo real. Actúa como concentrador central para el intercambio de mensajes entre vehículos, sistemas de control y aplicaciones de monitoreo con garantías de entrega y escalabilidad.

|       Elemento | Valor                                             |
| -------------: | ------------------------------------------------- |
|         Código | A1d                                               |
|  Clasificación | Aplicación                                        |
|       Catálogo | <CatalogItem catalog="applications" item="001" /> |
| Implementación | [Databús MQTT](/desarrollo/databus/#databus-mqtt) |

### Características generales

- **Protocolo MQTT 5.0:** Soporte completo con control de flujo
- **Tópicos jerárquicos especializados:** Estructura optimizada para datos GTFS (vehicle/route/trip/stop)
- **QoS adaptativo:** Niveles de servicio configurables según criticidad del mensaje
- **Persistencia selectiva:** Almacenamiento configurable de mensajes críticos con TTL
- **Seguridad:** TLS/SSL, autenticación por certificados y ACLs granulares
- **Interoperabilidad:** Conectores para WebSockets, AMQP y sistemas propietarios

## Aplicación móvil operativa

Aplicación móvil nativa diseñada para operadores de transporte público que combina funcionalidades de gestión operativa con capacidades de telemetría básica. Proporciona una interfaz intuitiva para el personal de campo con sincronización en tiempo real.

|       Elemento | Valor                                             |
| -------------: | ------------------------------------------------- |
|         Código | A1e                                               |
|  Clasificación | Aplicación                                        |
|       Catálogo | <CatalogItem catalog="applications" item="001" /> |
| Implementación | [Databús App](/desarrollo/databus/#databus-app)   |

### Subcomponentes

| Código | Nombre            | Descripción                                               |
| ------ | ----------------- | --------------------------------------------------------- |
| A1e-1  | Plataforma nativa | Capa de acceso a funcionalidades del sistema móvil        |
| A1e-2  | Cliente pub/sub   | Comunicación bidireccional para telemetría en tiempo real |

### Características generales

- **Panel operativo:** Métricas en tiempo real de ruta, horarios y rendimiento
- **Comunicación bidireccional:** Chat con despachadores y sistema de alertas
- **Telemetría vehicular:** Transmisión de posición, velocidad, ocupación y eventos
- **Reportes de incidencias:** Captura multimedia con geolocalización automática
- **Configuración dinámica:** Actualizaciones de parámetros operativos
