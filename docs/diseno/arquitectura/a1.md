# A1

::: info Descripción de la arquitectura

#### Recolección de datos y construcción de suministros (_feeds_)

La acción básica de este subsistema es recopilar los datos estáticos y en tiempo real del servicio de transporte público y recolectar y transformar los datos de telemetría y rastreo de los vehículos para publicación en suministros (_feeds_) de datos GTFS _Schedule_ y GTFS _Realtime_.

:::

**_Entradas_**

| Nombre               | Descripción                                                   |
| -------------------- | ------------------------------------------------------------- |
| GTFS _Schedule_      | Formato común para información estática de transporte público |
| Datos en tiempo real | Telemetría y rastreo de vehículos                             |
| Alertas del servicio | Reporte de afectaciones al servicio                           |

**_Salidas_**

| Nombre          | Descripción                                                   |
| --------------- | ------------------------------------------------------------- |
| GTFS _Schedule_ | Formato común para información estática de transporte público |
| GTFS _Realtime_ | Especificación para proporcionar información GTFS actualizada |

**_Componentes_**

| Código      | Componente                       |
| ----------- | -------------------------------- |
| **A1-RT**   | Servidor en tiempo real          |
| **A1-DB**   | Base de datos                    |
| **A1-IMDB** | Base de datos en memoria         |
| **A1-MQTT** | Intermediador (_broker_) pub/sub |
| **A1-APP**  | Aplicación móvil operativa       |

## Servidor en tiempo real

Plataforma central de procesamiento que recolecta, valida y transforma datos de rastreo y telemetría del transporte público en tiempo real. Genera y mantiene suministros (_feeds_) actualizados de GTFS _Schedule_ y GTFS _Realtime_ para distribución a aplicaciones cliente y sistemas externos.

|       Elemento | Valor                                             |
| -------------: | ------------------------------------------------- |
|         Código | **A1-RT**                                         |
|  Clasificación | Aplicación                                        |
|       Catálogo | <CatalogItem catalog="applications" item="001" /> |
| Implementación | [Databús RT](/desarrollo/databus/#databus-rt)     |

### Características generales

- **Procesamiento en tiempo real:** Latencia menor a 1 segundo para datos críticos
- **Tolerancia a fallos:** Redundancia automática y recuperación ante interrupciones
- **Monitoreo y alertas:** Sistema de métricas y notificaciones

### Relaciones con el sistema

| Relación          | Ítem de catálogo                                              |
| ----------------- | ------------------------------------------------------------- |
| implementa        | <CatalogItem catalog="principles" item="D02" show="name" />   |
| se realiza con    | <CatalogItem catalog="applications" item="001" show="name" /> |
| usado por         | <CatalogItem catalog="principles" item="A02" show="name" />   |
| es servido por    | <CatalogItem catalog="requirements" item="001" show="name" /> |
| es del interés de | <CatalogItem catalog="stakeholders" item="001" show="name" /> |
| es del interés de | <CatalogItem catalog="stakeholders" item="002" show="name" /> |
| usa               | <CatalogItem catalog="entities" item="002" show="name" />     |

### Subcomponentes

| Código        | Nombre                  | Descripción                                    |
| ------------- | ----------------------- | ---------------------------------------------- |
| A1-RT-API     | API REST                | Interfaz RESTful para operaciones CRUD         |
| A1-RT-GraphQL | API GraphQL             | Interfaz de consultas flexibles                |
| A1-RT-Queue   | Cola de tareas          | Gestión asíncrona de trabajos en segundo plano |
| A1-RT-Stream  | Procesamiento de flujos | Análisis continuo de datos en tiempo real      |

#### Interfaz API REST

Interfaz de programación de aplicaciones (API) RESTful que proporciona acceso estructurado y escalable a datos operativos del sistema de transporte público. Diseñada para integración con sistemas externos, aplicaciones móviles y herramientas de administración con patrones estándar de la industria.

|       Elemento | Valor                                             |
| -------------: | ------------------------------------------------- |
|         Código | **A1-RT-API**                                     |
|  Clasificación | Interfaz                                          |
|       Catálogo | <CatalogItem catalog="applications" item="001" /> |
| Implementación | [Databús API](/desarrollo/databus/#databus-api)   |

##### Características específicas

- **Especificación OpenAPI 3.0:** Documentación automática e interactiva de terminales (_endpoints_)
- **Autenticación OAuth 2.0 / JWT:** _Tokens_ seguros con alcance de acceso (_scope_) granular y renovación automática
- **Límite de consultas dinámico:** Límites adaptativos por cliente
- **Versionado semántico:** Compatibilidad hacia atrás con evolución controlada de API
- **Paginación inteligente:** División en páginas para grandes conjuntos de datos
- **Filtrado y ordenamiento:** Parámetros flexibles para consultas personalizadas

#### Interfaz API GraphQL

Interfaz de programación de aplicaciones (API) GraphQL que permite consultas flexibles y eficientes mediante un esquema unificado. Optimizada para clientes que requieren datos específicos con mínima transferencia de red y máxima expresividad en las consultas.

|       Elemento | Valor                                                   |
| -------------: | ------------------------------------------------------- |
|         Código | **A1-RT-GraphQL**                                       |
|  Clasificación | Interfaz                                                |
|       Catálogo | <CatalogItem catalog="applications" item="001" />       |
| Implementación | [Databús GraphQL](/desarrollo/databus/#databus-graphql) |

##### Características específicas

- **Esquema tipado fuerte:** Definición explícita de tipos con validación automática
- **Suscripciones en tiempo real:** WebSocket connections para actualizaciones instantáneas

#### Cola de tareas

Sistema de gestión asíncrona de trabajos en segundo plano que permite el procesamiento diferido, priorizado y resiliente de operaciones intensivas o de larga duración. Desacopla las solicitudes de usuario de tareas pesadas como generación de _feeds_ GTFS, análisis de datos históricos y procesamiento por lotes.

|       Elemento | Valor                                               |
| -------------: | --------------------------------------------------- |
|         Código | **A1-RT-Queue**                                     |
|  Clasificación | Componente de procesamiento                         |
|       Catálogo | <CatalogItem catalog="applications" item="001" />   |
| Implementación | [Databús Queue](/desarrollo/databus/#databus-queue) |

##### Características específicas

- **Colas múltiples con prioridades:** Separación de trabajos críticos, normales y de baja prioridad
- **Reintentos configurables:** Política de reintento exponencial con límites máximos
- **Programación temporal:** _Cron_ jobs y tareas diferidas con precisión de segundos
- **Monitoreo de tareas:** Dashboard para inspección de estado, progreso y fallos
- **Persistencia garantizada:** Almacenamiento durable de trabajos pendientes ante reinicios
- **Escalado horizontal:** Workers distribuidos con balanceo de carga automático

#### Procesamiento de flujos

Motor de análisis continuo de datos en tiempo real que consume, transforma y enriquece flujos (_streams_) de eventos de telemetría vehicular. Implementa patrones de procesamiento de eventos complejos (CEP) para detección de anomalías, agregaciones temporales y disparadores de alertas.

|       Elemento | Valor                                                 |
| -------------: | ----------------------------------------------------- |
|         Código | **A1-RT-Stream**                                      |
|  Clasificación | Componente de procesamiento                           |
|       Catálogo | <CatalogItem catalog="applications" item="001" />     |
| Implementación | [Databús Stream](/desarrollo/databus/#databus-stream) |

##### Características específicas

- **Ventanas temporales:** Agregaciones por tiempo fijo, deslizante y de sesión
- **Enriquecimiento de datos:** Unión (_join_) de flujos en tiempo real con datos de referencia GTFS
- **Detección de patrones:** Identificación de secuencias complejas de eventos vehiculares
- **Transformaciones stateful:** Mantenimiento de estado por vehículo/ruta con _checkpointing_
- **Exactamente una vez (_exactly-once_):** Garantías de procesamiento sin duplicación
- **Latencia predecible:** Procesamiento de eventos con latencia p99 < 500 ms

## Base de datos

Sistema de almacenamiento principal para datos operativos e históricos del transporte público, optimizado para consultas geoespaciales, análisis temporal y gestión de grandes volúmenes de información estructurada y semi-estructurada.

|       Elemento | Valor                                             |
| -------------: | ------------------------------------------------- |
|         Código | **A1-DB**                                         |
|  Clasificación | Componente de datos                               |
|       Catálogo | <CatalogItem catalog="applications" item="001" /> |
| Implementación | [Databús DB](/desarrollo/databus/#databus-db)     |

### Subcomponentes

| Código    | Nombre            | Descripción                                           |
| --------- | ----------------- | ----------------------------------------------------- |
| A1-DB-GEO | Geoespacial       | Consultas espaciales, índices geométricos, etc.       |
| A1-DB-TS  | Series temporales | Optimización para almacenamiento de series temporales |
| A1-DB-DOC | Documentos        | Soporte JSON/JSONB/BSON para almacenamiento flexible  |
| A1-DB-VEC | Vectores          | Almacenamiento de vectores para búsquedas semánticas  |

### Características generales

- **Motor relacional:** Transacciones ACID, integridad referencial
- **Respaldo automatizado:** Respaldos incrementales con retención configurable

## Base de datos en memoria

Caché de alta velocidad para datos temporales de rastreo y telemetría que requieren acceso rápido durante el procesamiento en tiempo real. Actúa como _buffer_ entre la ingesta de datos y el almacenamiento persistente.

|       Elemento | Valor                                             |
| -------------: | ------------------------------------------------- |
|         Código | **A1-IMDB**                                       |
|  Clasificación | Componente de datos                               |
|       Catálogo | <CatalogItem catalog="applications" item="001" /> |
| Implementación | [Databús IMDB](/desarrollo/databus/#databus-imdb) |

### Subcomponentes

| Código         | Nombre              | Descripción                                              |
| -------------- | ------------------- | -------------------------------------------------------- |
| A1-IMDB-Hash   | Tabla de dispersión | Instantáneas de estado con acceso rápido por llave-valor |
| A1-IMDB-Stream | Registro de anexión | Flujos de eventos con procesamiento secuencial ordenado  |

### Características generales

- **Latencia sub-milisegundo:** Acceso inmediato a datos frecuentemente consultados
- **Estructura de datos especializada:** Tablas con _hash_, conjuntos ordenados para consultas optimizadas
- **Expiración automática (TTL):** Limpieza automática de datos obsoletos
- **Persistencia opcional:** _Snapshots_ periódicos para recuperación ante fallos
- **Compresión en memoria:** Optimización del uso de RAM para mayor capacidad
- **Pub/Sub integrado:** Notificaciones en tiempo real de cambios de estado

## Intermediador MQTT

Intermediador (_broker_) de mensajes de publicación/suscripción MQTT de alto desempeño especializado en telemetría vehicular y comunicación en tiempo real. Actúa como concentrador central para el intercambio de mensajes entre vehículos, sistemas de control y aplicaciones de monitoreo con garantías de entrega y escalabilidad.

|       Elemento | Valor                                             |
| -------------: | ------------------------------------------------- |
|         Código | **A1-MQTT**                                       |
|  Clasificación | Aplicación                                        |
|       Catálogo | <CatalogItem catalog="applications" item="001" /> |
| Implementación | [Databús MQTT](/desarrollo/databus/#databus-mqtt) |

### Características generales

- **Protocolo MQTT 5.0:** Soporte completo con control de flujo
- **Tópicos jerárquicos especializados:** Estructura optimizada para datos GTFS (vehicle/route/trip/stop)
- **QoS adaptativo:** Niveles de servicio configurables según criticidad del mensaje
- **Persistencia selectiva:** Almacenamiento configurable de mensajes críticos con TTL
- **Seguridad:** TLS/SSL, autenticación por certificados y ACLs granulares
- **Interoperabilidad:** Conectores para WebSockets, AMQP y sistemas propietarios

## Aplicación móvil operativa

Aplicación móvil nativa diseñada para operadores de transporte público que combina funcionalidades de gestión operativa con capacidades de telemetría básica. Proporciona una interfaz intuitiva para el personal de campo con sincronización en tiempo real.

|       Elemento | Valor                                             |
| -------------: | ------------------------------------------------- |
|         Código | A1-APP                                            |
|  Clasificación | Aplicación                                        |
|       Catálogo | <CatalogItem catalog="applications" item="001" /> |
| Implementación | [Databús App](/desarrollo/databus/#databus-app)   |

### Subcomponentes

| Código      | Nombre               | Descripción                                        |
| ----------- | -------------------- | -------------------------------------------------- |
| A1-APP-OS   | Plataforma nativa    | Capa de acceso a funcionalidades del sistema móvil |
| A1-APP-MQTT | Cliente pub/sub MQTT | Comunicación para telemetría en tiempo real        |

### Características generales

- **Panel operativo:** Métricas en tiempo real de ruta, horarios y rendimiento
- **Comunicación bidireccional:** Chat con despachadores y sistema de alertas
- **Telemetría vehicular:** Transmisión de posición, velocidad, ocupación y eventos
- **Reportes de incidencias:** Captura multimedia con geolocalización automática
- **Configuración dinámica:** Actualizaciones de parámetros operativos
