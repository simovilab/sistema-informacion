# A2

::: info Descripción de la arquitectura

#### Distribución de información vía múltiples canales y protocolos

La acción básica de este subsistema es recopilar los datos GTFS _Schedule_ y GTFS _Realtime_ del servicio de transporte público -junto con otros datos complementarios- para luego distribuir a servicios de información en distintos canales digitales y con múltiples protocolos de comunicación.

:::

**_Entradas_**

| Nombre          | Descripción                                                   |
| --------------- | ------------------------------------------------------------- |
| GTFS _Schedule_ | Formato común para información estática de transporte público |
| GTFS _Realtime_ | Especificación para proporcionar información GTFS actualizada |
| Datos del clima | Actualizaciones del tiempo atmosférico                        |
| Calendario      | Eventos nacionales o locales                                  |

**_Salidas_**

| Nombre                        | Descripción                     |
| ----------------------------- | ------------------------------- |
| API                           | REST, GraphQL                   |
| Eventos en tiempo real        | SSE, WebSockets, webhooks, MQTT |
| Consultas semánticas          | SPARQL                          |
| Consultas en lenguaje natural | MCP                             |

**_Servicios_**

| Nombre                  | Descripción                          |
| ----------------------- | ------------------------------------ |
| Sitio web               | Central de información al usuario    |
| Pantallas informativas  | Información en tiempo real _in situ_ |
| Aplicación móvil        | Extensión del sitio web para móvil   |
| Rotulación automatizada | Creación programática de señales     |
| Panel de administración | Control de parámetros del sistema    |

**_Componentes_**

| Código     | Componente                              |
| ---------- | --------------------------------------- |
| A2-RT      | Servidor de distribución de información |
| A2-DB      | Base de datos                           |
| A2-IMDB    | Base de datos en memoria                |
| A2-SPARQL  | Terminal de consultas semánticas        |
| A2-MQTT    | Intermediador (_broker_) pub/sub        |
| A2-WEB     | Sitio web público                       |
| A2-APP     | Aplicación móvil pública                |
| A2-SCREENS | Pantallas basadas en web                |
| A2-MCP     | Protocolo de contexto de modelos        |

## Servidor en tiempo real

Plataforma central de procesamiento que recolecta suministros (_feeds_) actualizados de GTFS _Schedule_ y GTFS _Realtime_ para distribución a aplicaciones cliente y sistemas externos en múltiples formatos e interfaces.

|       Elemento | Valor                                             |
| -------------: | ------------------------------------------------- |
|         Código | **A2-RT**                                         |
|  Clasificación | Aplicación                                        |
|       Catálogo | <CatalogItem catalog="applications" item="001" /> |
| Implementación | [Infobús RT](/desarrollo/infobus/#infobus-rt)     |

### Características generales

- **Procesamiento en tiempo real:** Latencia menor a 1 segundo para datos críticos
- **Escalabilidad horizontal:** Capacidad de distribuir carga entre múltiples instancias
- **Tolerancia a fallos:** Redundancia automática y recuperación ante interrupciones
- **Validación de datos:** Verificación de integridad y consistencia de datos entrantes
- **Transformación de protocolos:** Conversión entre formatos de telemetría y estándares GTFS
- **Monitoreo y alertas:** Sistema de métricas y notificaciones
- **API de integración:** Conectores para sistemas CAD/AVL y plataformas de terceros

### Subcomponentes

| Código        | Nombre         | Descripción                                       |
| ------------- | -------------- | ------------------------------------------------- |
| A2-RT-API     | API REST       | Interfaz RESTful para operaciones CRUD            |
| A2-RT-GraphQL | API GraphQL    | Interfaz de consultas flexibles                   |
| A2-RT-Queue   | Cola de tareas | Gestión asíncrona de trabajos en segundo plano    |
| A2-RT-SSE     | SSE            | Canal unidireccional para eventos en tiempo real  |
| A2-RT-WS      | WebSockets     | Canal bidireccional de baja latencia              |
| A2-RT-WH      | Webhooks       | Notificaciones HTTP salientes a sistemas externos |

#### Interfaz API REST

Interfaz de programación de aplicaciones (API) RESTful que proporciona acceso estructurado y escalable a datos del sistema de transporte público. Diseñada para integración con sistemas externos, aplicaciones móviles y herramientas de administración con patrones estándar de la industria.

|       Elemento | Valor                                             |
| -------------: | ------------------------------------------------- |
|         Código | **A2-RT-API**                                     |
|  Clasificación | Interfaz                                          |
|       Catálogo | <CatalogItem catalog="applications" item="001" /> |
| Implementación | [Infobús RT](/desarrollo/infobus/#infobus-rt)     |

##### Características específicas

- **Especificación OpenAPI 3.0:** Documentación automática e interactiva de terminales (_endpoints_)
- **Autenticación OAuth 2.0 / JWT:** _Tokens_ seguros con alcance de acceso (_scope_) granular y renovación automática
- **Límite de consultas dinámico:** Límites adaptativos por cliente
- **Versionado semántico:** Compatibilidad hacia atrás con evolución controlada de API
- **Paginación inteligente:** División en páginas para grandes conjuntos de datos
- **Filtrado y ordenamiento:** Parámetros flexibles para consultas personalizadas

#### Interfaz API GraphQL

Interfaz de programación de aplicaciones (API) GraphQL que permite consultas flexibles y eficientes mediante un esquema unificado. Optimizada para clientes que requieren datos específicos con mínima transferencia de red y máxima expresividad en las consultas.

|       Elemento | Valor                                             |
| -------------: | ------------------------------------------------- |
|         Código | **A2-RT-GraphQL**                                 |
|  Clasificación | Interfaz                                          |
|       Catálogo | <CatalogItem catalog="applications" item="001" /> |
| Implementación | [Infobús RT](/desarrollo/infobus/#infobus-rt)     |

##### Características específicas

- **Esquema tipado fuerte:** Definición explícita de tipos con validación automática
- **Suscripciones en tiempo real:** Conexiones WebSocket para actualizaciones instantáneas

#### Interfaz de comunicación persistente con eventos enviados por el servidor (SSE)

Canal unidireccional servidor-a-cliente para enviar eventos en tiempo real sobre cambios de estado (vehículos, alertas, estimaciones) con baja sobrecarga y reconexión automática.

|       Elemento | Valor                                             |
| -------------: | ------------------------------------------------- |
|         Código | **A2-RT-SSE**                                     |
|  Clasificación | Interfaz                                          |
|       Catálogo | <CatalogItem catalog="applications" item="001" /> |
| Implementación | [Infobús RT](/desarrollo/infobus/#infobus-rt)     |

##### Características específicas

- **Reconexión automática:** Manejo de la conexión y reintentos exponenciales
- **Canales y filtros:** Suscripción por ruta, parada, línea o área
- **_Heartbeats_:** Mantiene la conexión activa y detecta cortes
- **Compatibilidad HTTP/2:** Funcionamiento sobre infraestructuras actuales
- **Compresión y _backpressure_:** Optimización del ancho de banda y control de flujo

#### Interfaz de comunicación persistente bidireccional (WebSockets)

Canal bidireccional de baja latencia para intercambio interactivo de eventos y comandos (suscripciones dinámicas, eco de posición, telemetría y notificaciones).

|       Elemento | Valor                                             |
| -------------: | ------------------------------------------------- |
|         Código | **A2-RT-WS**                                      |
|  Clasificación | Interfaz                                          |
|       Catálogo | <CatalogItem catalog="applications" item="001" /> |
| Implementación | [Infobús RT](/desarrollo/infobus/#infobus-rt)     |

##### Características específicas

- **Pub/Sub dinámico:** Alta/baja de tópicos y filtros en tiempo real
- **Soporte binario/JSON:** Mensajes compactos o legibles

#### Interfaz de notificaciones HTTP salientes (webhooks)

Mecanismo de entrega tipo _push_ hacia sistemas externos mediante conexión HTTP cuando ocurren eventos (nuevas alertas, cambios de servicio, incidencias).

|       Elemento | Valor                                             |
| -------------: | ------------------------------------------------- |
|         Código | **A2-RT-WH**                                      |
|  Clasificación | Interfaz                                          |
|       Catálogo | <CatalogItem catalog="applications" item="001" /> |
| Implementación | [Infobús RT](/desarrollo/infobus/#infobus-rt)     |

##### Características específicas

- **Entrega confiable:** Reintentos con política exponencial e idempotencia
- **Filtros por suscriptor:** Selección de eventos de interés

## Base de datos

Sistema de almacenamiento principal para datos operativos e históricos del transporte público, optimizado para consultas geoespaciales, análisis temporal y gestión de grandes volúmenes de información estructurada y semi-estructurada.

|       Elemento | Valor                                             |
| -------------: | ------------------------------------------------- |
|         Código | **A2-DB**                                         |
|  Clasificación | Componente de datos                               |
|       Catálogo | <CatalogItem catalog="applications" item="001" /> |
| Implementación | [Infobús DB](/desarrollo/infobus/#infobus-db)     |

### Características generales

- **Motor relacional:** Transacciones ACID, integridad referencial
- **Extensión geoespacial:** Consultas espaciales, índices geométricos, análisis de proximidad
- **Soporte JSON/JSONB/BSON:** Almacenamiento flexible de metadatos y configuraciones dinámicas
- **Series temporales optimizadas:** Particionamiento automático por tiempo, compresión de datos históricos
- **Respaldo automatizado:** Respaldos incrementales con retención configurable

### Subcomponentes

| Código    | Nombre            | Descripción                                           |
| --------- | ----------------- | ----------------------------------------------------- |
| A2-DB-GEO | Geoespacial       | Consultas espaciales, índices geométricos, etc.       |
| A2-DB-TS  | Series temporales | Optimización para almacenamiento de series temporales |
| A2-DB-DOC | Documentos        | Soporte JSON/JSONB/BSON para almacenamiento flexible  |
| A2-DB-VEC | Vectores          | Almacenamiento de vectores para búsquedas semánticas  |

## Base de datos en memoria

Caché de alta velocidad para datos temporales que requieren acceso rápido durante el procesamiento en tiempo real. Actúa como _buffer_ entre la ingesta de datos y el almacenamiento persistente.

|       Elemento | Valor                                             |
| -------------: | ------------------------------------------------- |
|         Código | **A2-IMDB**                                       |
|  Clasificación | Componente de datos                               |
|       Catálogo | <CatalogItem catalog="applications" item="001" /> |
| Implementación | [Infobús IMDB](/desarrollo/infobus/#databus-imdb) |

### Características generales

- **Latencia sub-milisegundo:** Acceso inmediato a datos frecuentemente consultados
- **Estructura de datos especializada:** Tablas con _hash_, conjuntos ordenados para consultas optimizadas
- **Expiración automática (TTL):** Limpieza automática de datos obsoletos
- **Persistencia opcional:** _Snapshots_ periódicos para recuperación ante fallos
- **Compresión en memoria:** Optimización del uso de RAM para mayor capacidad
- **Pub/Sub integrado:** Notificaciones en tiempo real de cambios de estado

### Subcomponentes

| Código         | Nombre              | Descripción                                              |
| -------------- | ------------------- | -------------------------------------------------------- |
| A2-IMDB-Hash   | Tabla de dispersión | Instantáneas de estado con acceso rápido por llave-valor |
| A2-IMDB-Stream | Registro de anexión | Flujos de eventos con procesamiento secuencial ordenado  |

## Intermediador MQTT

Intermediador (_broker_) de mensajes de publicación/suscripción MQTT de alto desempeño especializado en actualizaciones de información en tiempo real. Actúa como concentrador central para el intercambio de mensajes entre el servidor y los servicios de información.

|       Elemento | Valor                                             |
| -------------: | ------------------------------------------------- |
|         Código | **A2-MQTT**                                       |
|  Clasificación | Aplicación                                        |
|       Catálogo | <CatalogItem catalog="applications" item="001" /> |
| Implementación | [Infobús Web](/desarrollo/infobus/#infobus-mqtt)  |

### Características

- **Protocolo MQTT 5.0:** Soporte completo con control de flujo
- **Tópicos jerárquicos especializados:** Estructura optimizada para datos GTFS (vehicle/route/trip/stop)
- **QoS adaptativo:** Niveles de servicio configurables según criticidad del mensaje
- **Persistencia selectiva:** Almacenamiento configurable de mensajes críticos con TTL
- **Seguridad:** TLS/SSL, autenticación por certificados y ACLs granulares
- **Interoperabilidad:** Conectores para WebSockets, AMQP y sistemas propietarios

## Sitio web público

Portal de información ciudadana con información del servicio, próximas llegadas, alertas y contenidos editoriales.

|       Elemento | Valor                                             |
| -------------: | ------------------------------------------------- |
|         Código | **A2-WEB**                                        |
|  Clasificación | Aplicación                                        |
|       Catálogo | <CatalogItem catalog="applications" item="001" /> |
| Implementación | [Infobús Web](/desarrollo/infobus/#infobus-web)   |

### Características

- **Búsqueda de paradas y rutas:** Mapas interactivos y autocompletar
- **Próximas llegadas:** Estimaciones en tiempo real
- **Alertas y desvíos:** Bandeja de avisos por zona/línea
- **Accesibilidad y multilenguaje:** AA/AAA cuando aplique
- **Integración de contenido:** Noticias, guías y materiales del CMS
- **Chats de lenguaje natural con IA:** Consultas mediadas por MCP

## Pantallas informativas

Servidor para administración, orquestación y distribución de contenidos a pantallas en vehículos, paradas y estaciones. Aplicación web para kioscos/pantallas con renderizado optimizado y operación 24/7.

|       Elemento | Valor                                             |
| -------------: | ------------------------------------------------- |
|         Código | **A2-SCREENS**                                    |
|  Clasificación | Aplicación                                        |
|       Catálogo | <CatalogItem catalog="applications" item="001" /> |
| Implementación | [Infobús IMDB](/desarrollo/infobus/#databus-imdb) |

### Características

- **Listas de reproducción y horarios:** Programación por lugar/franja
- **Plantillas y temas:** Diseño consistente y reutilizable
- **Caché y modo fuera de línea:** Continuidad ante fallas de red
- **Monitoreo de salud:** _Heartbeats_ de clientes y alertas
- **Segmentación geográfica:** Contenidos por zona o línea
- **Integración en tiempo real:** Próximas llegadas y alertas operativas
- **Modo quiosco:** Pantalla completa y control de inactividad
- **Rendimiento:** Animaciones fluidas y actualización incremental
- **Accesibilidad:** Alto contraste, tipografías legibles
- **Localización:** Soporte multilenguaje (i18n)
- **Telemetría de cliente:** Logs para diagnóstico y calidad de servicio

## Aplicación móvil pública

Aplicación móvil para personas usuarias con información en tiempo real, notificaciones y herramientas de planificación básica.

|       Elemento | Valor                                             |
| -------------: | ------------------------------------------------- |
|         Código | **A2-APP**                                        |
|  Clasificación | Aplicación                                        |
|       Catálogo | <CatalogItem catalog="applications" item="001" /> |
| Implementación | [Infobús App](/desarrollo/infobus/#infobus-app)   |

### Características

- **Paradas y rutas cercanas:** Geolocalización y favoritos
- **Próximas llegadas:** Estimaciones y alertas personalizadas
- **Avisos de servicio:** Notificaciones push por línea/zona
- **Mapas y navegación básica:** Trayectos y transbordos simples
- **Accesibilidad:** Texto escalable, alto contraste y soporte _offline_ básico

## Consultas semánticas SPARQL

Interfaz de consultas semánticas SPARQL para bases de datos de tripletas (_triplestores_).

|       Elemento | Valor                                                 |
| -------------: | ----------------------------------------------------- |
|         Código | **A2-SPARQL**                                         |
|  Clasificación | Aplicación                                            |
|       Catálogo | <CatalogItem catalog="applications" item="001" />     |
| Implementación | [Infobús SPARQL](/desarrollo/infobus/#infobus-sparql) |

### Características

- **SPARQL 1.1 Query:** SELECT/ASK/CONSTRUCT/DESCRIBE
- **Catálogo de ontologías:** Vocabularios usados (GTFS, schema.org, etc.)
- **Consulta federada (opcional):** SERVICE hacia otras fuentes
- **Múltiples formatos:** JSON, XML, CSV

## Servidor/cliente MCP

Servidor especializado que implementa el el protocolo de contexto de modelos (MCP, _Model Context Protocol_) para proporcionar acceso conversacional a datos operativos mediante modelos de lenguaje extensos (LLM, _Large Language Models_). Actúa como puente inteligente entre consultas de lenguaje natural y sistemas de datos estructurados.

|       Elemento | Valor                                             |
| -------------: | ------------------------------------------------- |
|         Código | **A2-MCP**                                        |
|  Clasificación | Aplicación                                        |
|       Catálogo | <CatalogItem catalog="applications" item="001" /> |
| Implementación | [Infobús Web](/desarrollo/infobus/#infobus-mcp)   |

### Características

- **Implementación MCP completa:** Soporte total del protocolo con extensiones personalizadas
- **Consultas en lenguaje natural:** Traducción automática de preguntas a consultas SQL/GraphQL/SPARQL
- **Contexto:** Mantenimiento de estado conversacional con memoria persistente
